class AdminManager {
    constructor() {
        this.stats = {};
        this.users = [];
        this.shops = [];
        this.products = [];
        this.orders = [];
        this.init();
    }

    async init() {
        try {
            const user = await apiService.getProfile();
            if (user.role === 'admin') {
                await this.loadAllData();
                this.setupRealTimeUpdates();
            }
        } catch (error) {
            console.error('Failed to initialize admin manager:', error);
        }
    }

    async loadAllData() {
        try {
            const [stats, shops, products] = await Promise.all([
                apiService.getAdminStats(),
                apiService.getShops(),
                apiService.getProducts()\n            ]);\n\n            this.stats = stats;\n            this.shops = shops;\n            this.products = products;\n            \n            this.updateDashboard();\n            return { stats, shops, products };\n        } catch (error) {\n            console.error('Failed to load admin data:', error);\n            return {};\n        }\n    }\n\n    updateDashboard() {\n        // Update stats cards\n        this.updateElement('totalShops', this.stats.total_shops || 0);\n        this.updateElement('totalProducts', this.stats.total_products || 0);\n        this.updateElement('totalUsers', this.stats.total_users || 0);\n        this.updateElement('totalRevenue', (this.stats.total_revenue || 0).toLocaleString());\n        this.updateElement('ordersToday', this.stats.orders_today || 0);\n        \n        // Update recent activity table\n        this.updateRecentActivity();\n        \n        // Update shop performance\n        this.updateShopPerformance();\n    }\n\n    updateElement(id, value) {\n        const element = document.getElementById(id);\n        if (element) {\n            element.textContent = value;\n        }\n    }\n\n    updateRecentActivity() {\n        const container = document.getElementById('recentActivityTable');\n        if (!container || !this.stats.recent_orders) return;\n\n        const tbody = container.querySelector('tbody');\n        if (tbody) {\n            tbody.innerHTML = this.stats.recent_orders.map(order => `\n                <tr>\n                    <td>${new Date(order.created_at).toLocaleTimeString()}</td>\n                    <td>${order.user__username}</td>\n                    <td>Order placed - ₹${order.total_amount}</td>\n                    <td class=\"status-active\">${order.status}</td>\n                </tr>\n            `).join('');\n        }\n    }\n\n    updateShopPerformance() {\n        const table = document.getElementById('shopPerformanceTable');\n        if (!table || !this.shops.length) return;\n\n        table.innerHTML = this.shops.slice(0, 4).map(shop => `\n            <tr>\n                <td>${shop.name}</td>\n                <td class=\"status-active\">Active</td>\n                <td>${this.getShopRevenue(shop.id)}</td>\n            </tr>\n        `).join('');\n    }\n\n    getShopRevenue(shopId) {\n        // Calculate shop revenue based on products and orders\n        const shopProducts = this.products.filter(p => p.shop === shopId);\n        const baseRevenue = shopProducts.length * 1000; // Placeholder calculation\n        return `₹${baseRevenue.toLocaleString()}`;\n    }\n\n    async manageUsers() {\n        this.showManagementModal('Users', await this.getUsersData());\n    }\n\n    async manageShops() {\n        this.showManagementModal('Shops', await this.getShopsData());\n    }\n\n    async manageProducts() {\n        this.showManagementModal('Products', await this.getProductsData());\n    }\n\n    async getUsersData() {\n        // This would typically come from an admin-specific API endpoint\n        return [\n            { id: 1, username: 'john_doe', email: 'john@example.com', role: 'customer', status: 'active' },\n            { id: 2, username: 'jane_merchant', email: 'jane@shop.com', role: 'merchant', status: 'active' },\n            { id: 3, username: 'admin_user', email: 'admin@supermall.com', role: 'admin', status: 'active' }\n        ];\n    }\n\n    async getShopsData() {\n        return this.shops.map(shop => ({\n            id: shop.id,\n            name: shop.name,\n            category: shop.category,\n            merchant: shop.merchant,\n            status: shop.is_active ? 'active' : 'inactive',\n            products: this.products.filter(p => p.shop === shop.id).length\n        }));\n    }\n\n    async getProductsData() {\n        return this.products.map(product => ({\n            id: product.id,\n            name: product.name,\n            price: product.price,\n            category: product.category,\n            shop: this.shops.find(s => s.id === product.shop)?.name || 'Unknown',\n            status: product.is_active ? 'active' : 'inactive'\n        }));\n    }\n\n    showManagementModal(title, data) {\n        const modal = document.createElement('div');\n        modal.style.cssText = `\n            position: fixed;\n            top: 0;\n            left: 0;\n            width: 100%;\n            height: 100%;\n            background: rgba(0,0,0,0.5);\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            z-index: 10000;\n        `;\n\n        modal.innerHTML = `\n            <div style=\"background: white; border-radius: 12px; padding: 30px; max-width: 800px; width: 90%; max-height: 90vh; overflow-y: auto;\">\n                <div style=\"display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;\">\n                    <h3>Manage ${title}</h3>\n                    <button onclick=\"this.closest('.admin-modal').remove()\" \n                            style=\"background: #f56565; color: white; border: none; padding: 8px 12px; border-radius: 6px; cursor: pointer;\">\n                        ✕ Close\n                    </button>\n                </div>\n                <div style=\"overflow-x: auto;\">\n                    ${this.renderDataTable(data, title.toLowerCase())}\n                </div>\n            </div>\n        `;\n\n        modal.className = 'admin-modal';\n        document.body.appendChild(modal);\n    }\n\n    renderDataTable(data, type) {\n        if (!data.length) {\n            return `<p style=\"text-align: center; color: #718096;\">No ${type} found</p>`;\n        }\n\n        const headers = Object.keys(data[0]);\n        \n        return `\n            <table style=\"width: 100%; border-collapse: collapse; margin-top: 15px;\">\n                <thead>\n                    <tr style=\"background: #f7fafc;\">\n                        ${headers.map(header => `<th style=\"padding: 12px; text-align: left; border-bottom: 1px solid #e2e8f0; font-weight: 600;\">${header.charAt(0).toUpperCase() + header.slice(1)}</th>`).join('')}\n                        <th style=\"padding: 12px; text-align: left; border-bottom: 1px solid #e2e8f0; font-weight: 600;\">Actions</th>\n                    </tr>\n                </thead>\n                <tbody>\n                    ${data.map(item => `\n                        <tr>\n                            ${headers.map(header => `<td style=\"padding: 12px; border-bottom: 1px solid #e2e8f0;\">${item[header]}</td>`).join('')}\n                            <td style=\"padding: 12px; border-bottom: 1px solid #e2e8f0;\">\n                                <button onclick=\"adminManager.editItem('${type}', ${item.id})\" \n                                        style=\"background: #667eea; color: white; border: none; padding: 4px 8px; border-radius: 4px; cursor: pointer; margin-right: 5px;\">\n                                    Edit\n                                </button>\n                                <button onclick=\"adminManager.deleteItem('${type}', ${item.id})\" \n                                        style=\"background: #f56565; color: white; border: none; padding: 4px 8px; border-radius: 4px; cursor: pointer;\">\n                                    Delete\n                                </button>\n                            </td>\n                        </tr>\n                    `).join('')}\n                </tbody>\n            </table>\n        `;\n    }\n\n    async editItem(type, id) {\n        this.showNotification(`Edit ${type} #${id} functionality would be implemented here`, 'info');\n    }\n\n    async deleteItem(type, id) {\n        if (confirm(`Are you sure you want to delete this ${type}?`)) {\n            this.showNotification(`Delete ${type} #${id} functionality would be implemented here`, 'info');\n        }\n    }\n\n    async generateReport() {\n        const report = {\n            timestamp: new Date().toISOString(),\n            summary: {\n                total_shops: this.stats.total_shops || 0,\n                total_products: this.stats.total_products || 0,\n                total_users: this.stats.total_users || 0,\n                total_revenue: this.stats.total_revenue || 0,\n                orders_today: this.stats.orders_today || 0\n            },\n            top_shops: this.shops.slice(0, 5).map(shop => ({\n                name: shop.name,\n                category: shop.category,\n                products: this.products.filter(p => p.shop === shop.id).length\n            })),\n            recent_activity: this.stats.recent_orders || []\n        };\n\n        // Create downloadable report\n        const blob = new Blob([JSON.stringify(report, null, 2)], { type: 'application/json' });\n        const url = URL.createObjectURL(blob);\n        const a = document.createElement('a');\n        a.href = url;\n        a.download = `supermall-report-${new Date().toISOString().split('T')[0]}.json`;\n        document.body.appendChild(a);\n        a.click();\n        document.body.removeChild(a);\n        URL.revokeObjectURL(url);\n\n        this.showNotification('Report generated and downloaded successfully!', 'success');\n    }\n\n    setupRealTimeUpdates() {\n        // Update dashboard every 30 seconds\n        setInterval(async () => {\n            try {\n                await this.loadAllData();\n            } catch (error) {\n                console.log('Real-time update failed:', error);\n            }\n        }, 30000);\n    }\n\n    showNotification(message, type = 'info') {\n        const notification = document.createElement('div');\n        const bgColor = type === 'success' ? '#48bb78' : type === 'error' ? '#f56565' : '#667eea';\n        const icon = type === 'success' ? '✅' : type === 'error' ? '❌' : 'ℹ️';\n        \n        notification.style.cssText = `\n            position: fixed;\n            top: 20px;\n            right: 20px;\n            background: ${bgColor};\n            color: white;\n            padding: 15px 20px;\n            border-radius: 8px;\n            z-index: 10000;\n            box-shadow: 0 4px 12px rgba(0,0,0,0.15);\n            max-width: 300px;\n        `;\n        notification.textContent = `${icon} ${message}`;\n        document.body.appendChild(notification);\n        \n        setTimeout(() => {\n            notification.remove();\n        }, 3000);\n    }\n}\n\n// Global admin manager\nconst adminManager = new AdminManager();