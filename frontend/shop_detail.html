<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Shop Details - SuperMall</title>

    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="static/css/main.css">
    <link rel="stylesheet" href="static/css/components.css">
</head>

<body>

    <nav class="navbar">
        <div class="nav-left">
            <span class="logo-text">üõí SuperMall</span>
        </div>
        <div class="nav-right">
            <a href="index.html">Home</a>
            <a href="shop_list.html">Shops</a>
            <a href="compare.html">Compare</a>
            <a href="login.html" class="btn-primary">Login</a>
        </div>
    </nav>

    <main class="container">
        
<div class="shop-header" id="shopHeader">
    <img src="https://images.unsplash.com/photo-1542838132-92c53300491e?w=600" class="shop-banner" id="shopBanner">
    <h2 id="shopName">Loading...</h2>
    <p id="shopDescription">Loading shop details...</p>
</div>

<div style="padding: 60px 5%;">
    <h3 style="font-size: 2rem; margin-bottom: 30px; color: #1a202c;">üõí Available Products</h3>
    <div class="product-grid" id="productGrid">
        <div style="text-align: center; padding: 40px; color: #718096;">
            <p>Loading products...</p>
        </div>
    </div>
</div>

    </main>

    <footer class="footer">
        <div style="max-width: 1400px; margin: 0 auto;">
            <p>¬© 2025 SuperMall ‚Äî Your Smart Shopping Destination</p>
            <p style="margin-top: 10px; font-size: 0.9rem; opacity: 0.8;">Discover ‚Ä¢ Compare ‚Ä¢ Shop</p>
        </div>
    </footer>

    <script src="static/js/config.js"></script>
    <script src="static/js/api.js"></script>
    <script src="static/js/enhanced-cart.js"></script>
    <script>
        let currentShopId = null;

        document.addEventListener('DOMContentLoaded', async () => {
            // Get shop ID from URL
            const urlParams = new URLSearchParams(window.location.search);
            currentShopId = urlParams.get('id');
            
            if (!currentShopId) {
                // Try to extract from filename (shop_1.html -> id=1)
                const filename = window.location.pathname.split('/').pop();
                const match = filename.match(/shop_(\d+)\.html/);
                if (match) {
                    currentShopId = match[1];
                }
            }

            if (currentShopId) {
                await loadShopDetails();
                await loadShopProducts();
            } else {
                document.getElementById('shopName').textContent = 'Shop Not Found';
                document.getElementById('shopDescription').textContent = 'Invalid shop ID';
                document.getElementById('productGrid').innerHTML = '<p style="text-align: center; color: #718096;">Shop not found</p>';
            }
        });

        async function loadShopDetails() {
            try {
                const response = await apiService.get(`/shops/${currentShopId}/`);
                if (response.success && response.data) {
                    const shop = response.data;
                    document.getElementById('shopName').textContent = shop.name;
                    document.getElementById('shopDescription').textContent = shop.description || 'Welcome to our shop!';
                    
                    if (shop.image_url) {
                        document.getElementById('shopBanner').src = shop.image_url;
                    }
                    
                    document.title = `${shop.name} - SuperMall`;
                } else {
                    throw new Error('Shop not found');
                }
            } catch (error) {
                console.error('Error loading shop details:', error);
                document.getElementById('shopName').textContent = 'Shop Not Found';
                document.getElementById('shopDescription').textContent = 'Unable to load shop details';
            }
        }

        async function loadShopProducts() {
            try {
                const response = await apiService.get(`/products/shop/${currentShopId}/`);
                const productGrid = document.getElementById('productGrid');
                
                if (response.success && response.data && response.data.length > 0) {
                    productGrid.innerHTML = response.data.map(product => `
                        <div class="product-card">
                            <img src="${product.image_url || 'https://images.unsplash.com/photo-1560472354-b33ff0c44a43?w=300'}" alt="${product.name}">
                            <h4>${product.name}</h4>
                            <p>‚Çπ${parseFloat(product.price).toLocaleString()}</p>
                            <div class="product-actions">
                                <button onclick="addToCart(${product.id}, '${product.name}', ${product.price})" class="btn-cart">üõí Add to Cart</button>
                                <button onclick="addToWishlist(${product.id}, '${product.name}', ${product.price})" class="btn-wishlist">‚ù§Ô∏è</button>
                            </div>
                        </div>
                    `).join('');
                } else {
                    productGrid.innerHTML = `
                        <div style="text-align: center; padding: 40px; color: #718096;">
                            <h4>No Products Available</h4>
                            <p>This shop doesn't have any products yet. Check back later!</p>
                        </div>
                    `;
                }
            } catch (error) {
                console.error('Error loading products:', error);
                document.getElementById('productGrid').innerHTML = `
                    <div style="text-align: center; padding: 40px; color: #e53e3e;">
                        <h4>Error Loading Products</h4>
                        <p>Unable to load products. Please try again later.</p>
                    </div>
                `;
            }
        }

        function addToCart(productId, productName, price) {
            if (typeof enhancedCartManager !== 'undefined') {
                enhancedCartManager.addToCart({
                    id: productId,
                    name: productName,
                    price: price,
                    image: 'https://images.unsplash.com/photo-1560472354-b33ff0c44a43?w=300',
                    quantity: 1
                });
                alert(`${productName} added to cart!`);
            } else {
                alert('Cart functionality not available');
            }
        }

        function addToWishlist(productId, productName, price) {
            // Simple wishlist implementation
            let wishlist = JSON.parse(localStorage.getItem('wishlist') || '[]');
            const existingItem = wishlist.find(item => item.id === productId);
            
            if (!existingItem) {
                wishlist.push({
                    id: productId,
                    name: productName,
                    price: price,
                    image: 'https://images.unsplash.com/photo-1560472354-b33ff0c44a43?w=300'
                });
                localStorage.setItem('wishlist', JSON.stringify(wishlist));
                alert(`${productName} added to wishlist!`);
            } else {
                alert(`${productName} is already in your wishlist!`);
            }
        }
    </script>

</body>

</html>
